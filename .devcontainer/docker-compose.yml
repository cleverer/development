version: '3.4'
services:
  rails:
    volumes:
      - .:/workspace:cached

    # Skip entrypoint which would try to migrate on entry
    entrypoint: []
    # Overrides default command so things don't shut down after the process ends.
    command: sleep infinity
    healthcheck: {}
    privileged: true
  worker:
    depends_on:
      rails:
        condition: service_started
      db:
        condition: service_healthy
      mailcatcher:
        condition: service_healthy
      cache:
        condition: service_started
  sphinx:
    depends_on:
      db:
        condition: service_healthy
      rails:
        condition: service_started